{
  "hash": "b8c19b93133c622bb5f49042e76398ee",
  "result": {
    "engine": "jupyter",
    "markdown": "---\nexecute:\n  cache: false\n  eval: true\n  echo: true\n  warning: false\ntitle: 'HPT PyTorch Lightning: User Specified Data Set and Regression Model'\n---\n\nIn this tutorial, we will show how `spotPython` can be integrated into the `PyTorch` Lightning\ntraining workflow for a regression task with a user specified data set and a user specified regression model.\n\nThis chapter describes the hyperparameter tuning of a `PyTorch Lightning` network on a user data set, which can be found in the subfolder of this notebook, `userData`.\nThe network can be found in the subfolder `userModel`.\n\n## Step 1: Setup {#sec-setup-33}\n\n* Before we consider the detailed experimental setup, we select the parameters that affect run time, initial design size, etc. \n* The parameter `MAX_TIME` specifies the maximum run time in seconds.\n* The parameter `INIT_SIZE` specifies the initial design size.\n* The parameter `WORKERS` specifies the number of workers. \n* The prefix `PREFIX` is used for the experiment name and the name of the log file.\n* The parameter `DEVICE` specifies the device to use for training.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nfrom spotPython.utils.device import getDevice\nfrom math import inf\n\nMAX_TIME = 10\nFUN_EVALS = inf\nFUN_REPEATS = 2\nOCBA_DELTA = 1\nREPEATS = 2\nINIT_SIZE = 10\nWORKERS = 0\nPREFIX=\"032\"\nDEVICE = getDevice()\nDEVICES = 1\nTEST_SIZE = 0.3\n```\n:::\n\n\n::: {.callout-caution}\n### Caution: Run time and initial design size should be increased for real experiments\n\n* `MAX_TIME` is set to one minute for demonstration purposes. For real experiments, this should be increased to at least 1 hour.\n* `INIT_SIZE` is set to 5 for demonstration purposes. For real experiments, this should be increased to at least 10.\n* `WORKERS` is set to 0 for demonstration purposes. For real experiments, this should be increased. See the warnings that are printed when the number of workers is set to 0.\n\n:::\n\n::: {.callout-note}\n### Note: Device selection\n\n* Although there are no .cuda() or .to(device) calls required, because Lightning does these for you, see \n[LIGHTNINGMODULE](https://lightning.ai/docs/pytorch/stable/common/lightning_module.html), we would like to know which device is used. Threrefore, we imitate the LightningModule behaviour which selects the highest device. \n* The method `spotPython.utils.device.getDevice()` returns the device that is used by Lightning.\n:::\n\n\n## Step 2: Initialization of the `fun_control` Dictionary\n\n`spotPython` uses a Python dictionary for storing the information required for the hyperparameter tuning process.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nfrom spotPython.utils.init import fun_control_init\nimport numpy as np\nfun_control = fun_control_init(\n    _L_in=133,\n    _L_out=1,\n    PREFIX=PREFIX,\n    TENSORBOARD_CLEAN=True,\n    device=DEVICE,\n    enable_progress_bar=False,\n    fun_evals=FUN_EVALS,\n    fun_repeats=FUN_REPEATS,\n    log_level=10,\n    max_time=MAX_TIME,\n    num_workers=WORKERS,\n    ocba_delta = OCBA_DELTA,\n    show_progress=True,\n    test_size=TEST_SIZE,\n    tolerance_x=np.sqrt(np.spacing(1)),\n    verbosity=1,\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nMoving TENSORBOARD_PATH: runs/ to TENSORBOARD_PATH_OLD: runs_OLD/runs_2024_01_15_03_37_22\nCreated spot_tensorboard_path: runs/spot_logs/032_p040025_2024-01-15_03-37-22 for SummaryWriter()\n```\n:::\n:::\n\n\n## Step 3: Loading the User Specified Data Set\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nfrom spotPython.hyperparameters.values import set_control_key_value\nfrom spotPython.data.pkldataset import PKLDataset\nimport torch\ndataset = PKLDataset(directory=\"./userData/\",\n                     filename=\"data_sensitive.pkl\",\n                     target_column='N',\n                     feature_type=torch.float32,\n                     target_type=torch.float32,\n                     rmNA=True)\nset_control_key_value(control_dict=fun_control,\n                        key=\"data_set\",\n                        value=dataset,\n                        replace=True)\nprint(len(dataset))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n2381\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Note: Data Set and Data Loader\n\n* As shown below, a DataLoader from `torch.utils.data` can be used to check the data.\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n# Set batch size for DataLoader\nbatch_size = 5\n# Create DataLoader\nfrom torch.utils.data import DataLoader\ndataloader = DataLoader(dataset, batch_size=batch_size, shuffle=False)\n\n# Iterate over the data in the DataLoader\nfor batch in dataloader:\n    inputs, targets = batch\n    print(f\"Batch Size: {inputs.size(0)}\")\n    print(f\"Inputs Shape: {inputs.shape}\")\n    print(f\"Targets Shape: {targets.shape}\")\n    print(\"---------------\")\n    print(f\"Inputs: {inputs}\")\n    print(f\"Targets: {targets}\")\n    break\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBatch Size: 5\nInputs Shape: torch.Size([5, 133])\nTargets Shape: torch.Size([5])\n---------------\nInputs: tensor([[6.2000e+01, 5.0100e+02, 1.0000e+00, 2.0000e+00, 2.0000e+00, 2.0000e+00,\n         1.8000e+01, 1.2310e+03, 1.6000e+01, 1.8950e+03, 4.0000e+00, 1.3000e+01,\n         1.6070e+03, 6.3700e+02, 5.1600e+02, 5.1000e+01, 1.0000e+00, 1.0000e+00,\n         1.0000e+00, 6.0000e+00, 0.0000e+00, 4.5000e+01, 4.6000e+01, 2.0000e+00,\n         1.4210e+03, 1.2490e+03, 1.8890e+03, 1.8880e+03, 1.8670e+03, 5.5500e+02,\n         1.8040e+03, 1.0000e+00, 1.8000e+01, 1.1880e+03, 7.7300e+02, 7.7400e+02,\n         7.8200e+02, 7.8000e+02, 6.2600e+02, 7.5700e+02, 7.5100e+02, 3.4700e+02,\n         7.5000e+02, 7.7900e+02, 6.2900e+02, 5.9000e+01, 7.1500e+02, 7.1700e+02,\n         7.3000e+02, 6.5600e+02, 2.1000e+01, 5.4200e+02, 1.7300e+02, 4.6500e+02,\n         1.1000e+02, 3.9900e+02, 7.7800e+02, 7.7700e+02, 6.2900e+02, 7.8200e+02,\n         7.8200e+02, 6.7500e+02, 6.7500e+02, 7.7100e+02, 7.7000e+01, 7.9000e+01,\n         7.7900e+02, 7.7900e+02, 7.0500e+02, 6.6100e+02, 7.2900e+02, 7.3400e+02,\n         4.7800e+02, 7.7300e+02, 7.7400e+02, 7.7300e+02, 7.7400e+02, 7.7100e+02,\n         7.7200e+02, 7.7200e+02, 5.9000e+01, 7.1500e+02, 0.0000e+00, 7.2400e+02,\n         7.7100e+02, 1.3000e+02, 4.9700e+02, 0.0000e+00, 7.0100e+02, 1.9800e+02,\n         7.8200e+02, 1.4900e+02, 7.6300e+02, 7.0900e+02, 7.1700e+02, 7.3200e+02,\n         6.2000e+01, 7.2000e+02, 7.7400e+02, 6.6000e+01, 7.8300e+02, 7.8300e+02,\n         4.0100e+02, 7.2500e+02, 1.2600e+02, 5.0000e+00, 6.4300e+02, 3.2000e+01,\n         3.2000e+01, 3.0000e+01, 7.4400e+02, 6.1100e+02, 7.3100e+02, 7.8300e+02,\n         7.7600e+02, 7.8200e+02, 7.5700e+02, 7.8200e+02, 7.8300e+02, 7.8200e+02,\n         2.9600e+02, 2.9600e+02, 6.9500e+02, 5.6900e+02, 7.4800e+02, 7.8200e+02,\n         7.8300e+02, 4.0500e+02, 1.3400e+02, 7.1700e+02, 6.6100e+02, 3.6000e+01,\n         3.6000e+01],\n        [5.6000e+01, 4.9800e+02, 1.0000e+00, 2.0000e+00, 2.0000e+00, 2.0000e+00,\n         2.1000e+01, 1.2040e+03, 1.6000e+01, 1.8680e+03, 4.0000e+00, 1.2000e+01,\n         5.1400e+02, 7.1500e+02, 6.5100e+02, 4.8000e+01, 4.7000e+01, 5.5000e+01,\n         4.8000e+01, 2.9000e+01, 0.0000e+00, 6.7000e+01, 6.3000e+01, 2.0000e+00,\n         2.3620e+03, 2.3560e+03, 1.8030e+03, 1.8950e+03, 1.9590e+03, 7.0400e+02,\n         1.4150e+03, 4.0000e+00, 2.1000e+01, 1.1690e+03, 7.7300e+02, 7.7400e+02,\n         7.8200e+02, 7.8000e+02, 6.2600e+02, 7.5700e+02, 7.5100e+02, 3.4700e+02,\n         7.5000e+02, 7.7900e+02, 6.2900e+02, 5.9000e+01, 7.1500e+02, 7.1700e+02,\n         7.3000e+02, 6.5600e+02, 2.1000e+01, 5.4200e+02, 1.7300e+02, 4.6500e+02,\n         1.1000e+02, 3.9900e+02, 7.7800e+02, 7.7700e+02, 6.2900e+02, 7.8200e+02,\n         7.8200e+02, 6.7500e+02, 6.7500e+02, 7.7100e+02, 7.7000e+01, 7.9000e+01,\n         7.7900e+02, 7.7900e+02, 7.0500e+02, 6.6100e+02, 7.2900e+02, 7.3400e+02,\n         4.7800e+02, 7.7300e+02, 7.7400e+02, 7.7300e+02, 7.7400e+02, 7.7100e+02,\n         7.7200e+02, 7.7200e+02, 5.9000e+01, 7.1500e+02, 0.0000e+00, 7.2400e+02,\n         7.7100e+02, 1.3000e+02, 4.9700e+02, 0.0000e+00, 7.0100e+02, 1.9800e+02,\n         7.8200e+02, 1.4900e+02, 7.6300e+02, 7.0900e+02, 7.1700e+02, 7.3200e+02,\n         6.2000e+01, 7.2000e+02, 7.7400e+02, 6.6000e+01, 7.8300e+02, 7.8300e+02,\n         4.0100e+02, 7.2500e+02, 1.2600e+02, 5.0000e+00, 6.4300e+02, 3.2000e+01,\n         3.2000e+01, 3.0000e+01, 7.4400e+02, 6.1100e+02, 7.3100e+02, 7.8300e+02,\n         7.7600e+02, 7.8200e+02, 7.5700e+02, 7.8200e+02, 7.8300e+02, 7.8200e+02,\n         2.9600e+02, 2.9600e+02, 6.9500e+02, 5.6900e+02, 7.4800e+02, 7.8200e+02,\n         7.8300e+02, 4.0500e+02, 1.3400e+02, 7.1700e+02, 6.6100e+02, 3.4000e+01,\n         3.4000e+01],\n        [1.0000e+01, 4.6800e+02, 1.0000e+00, 2.0000e+00, 2.0000e+00, 1.0000e+00,\n         2.4000e+01, 1.1970e+03, 1.8000e+01, 2.2500e+03, 3.0000e+00, 1.6000e+01,\n         5.9900e+02, 6.9200e+02, 6.3200e+02, 5.6000e+01, 4.5000e+01, 5.1000e+01,\n         4.2000e+01, 2.7000e+01, 0.0000e+00, 2.8000e+01, 3.0000e+01, 1.0000e+00,\n         2.2200e+02, 2.9600e+02, 2.2540e+03, 2.2530e+03, 2.2450e+03, 7.3800e+02,\n         2.1920e+03, 2.0000e+00, 2.4000e+01, 1.1600e+03, 7.7300e+02, 7.7400e+02,\n         7.8200e+02, 7.8000e+02, 6.2600e+02, 7.5700e+02, 7.5100e+02, 3.4700e+02,\n         7.5000e+02, 7.7900e+02, 6.2900e+02, 5.9000e+01, 7.1500e+02, 7.1700e+02,\n         7.3000e+02, 6.5600e+02, 2.1000e+01, 5.4200e+02, 1.7300e+02, 4.6500e+02,\n         1.1000e+02, 3.9900e+02, 7.7800e+02, 7.7700e+02, 6.2900e+02, 7.8200e+02,\n         7.8200e+02, 6.7500e+02, 6.7500e+02, 7.7100e+02, 7.7000e+01, 7.9000e+01,\n         7.7900e+02, 7.7900e+02, 7.0500e+02, 6.6100e+02, 7.2900e+02, 7.3400e+02,\n         4.7800e+02, 7.7300e+02, 7.7400e+02, 7.7300e+02, 7.7400e+02, 7.7100e+02,\n         7.7200e+02, 7.7200e+02, 5.9000e+01, 7.1500e+02, 0.0000e+00, 7.2400e+02,\n         7.7100e+02, 1.3000e+02, 4.9700e+02, 0.0000e+00, 7.0100e+02, 1.9800e+02,\n         7.8200e+02, 1.4900e+02, 7.6300e+02, 7.0900e+02, 7.1700e+02, 7.3200e+02,\n         6.2000e+01, 7.2000e+02, 7.7400e+02, 6.6000e+01, 7.8300e+02, 7.8300e+02,\n         4.0100e+02, 7.2500e+02, 1.2600e+02, 5.0000e+00, 6.4300e+02, 3.2000e+01,\n         3.2000e+01, 3.0000e+01, 7.4400e+02, 6.1100e+02, 7.3100e+02, 7.8300e+02,\n         7.7600e+02, 7.8200e+02, 7.5700e+02, 7.8200e+02, 7.8300e+02, 7.8200e+02,\n         2.9600e+02, 2.9600e+02, 6.9500e+02, 5.6900e+02, 7.4800e+02, 7.8200e+02,\n         7.8300e+02, 4.0500e+02, 1.3400e+02, 7.1700e+02, 6.6100e+02, 3.9000e+01,\n         3.9000e+01],\n        [3.7000e+01, 3.6600e+02, 1.0000e+00, 2.0000e+00, 2.0000e+00, 0.0000e+00,\n         3.5000e+01, 1.1860e+03, 1.6000e+01, 1.8620e+03, 4.0000e+00, 1.2000e+01,\n         1.2020e+03, 1.3080e+03, 1.1710e+03, 4.8000e+01, 4.7000e+01, 5.5000e+01,\n         4.8000e+01, 2.9000e+01, 0.0000e+00, 6.7000e+01, 6.3000e+01, 2.0000e+00,\n         1.3200e+02, 1.1200e+02, 1.8770e+03, 1.8690e+03, 1.8450e+03, 1.0800e+03,\n         4.7700e+02, 3.0000e+00, 3.5000e+01, 1.1290e+03, 7.6300e+02, 7.7700e+02,\n         7.7700e+02, 7.7400e+02, 1.5100e+02, 7.4700e+02, 7.1700e+02, 3.5200e+02,\n         7.2800e+02, 7.5200e+02, 6.2800e+02, 5.1000e+01, 7.0400e+02, 7.0700e+02,\n         7.1500e+02, 6.4200e+02, 2.0000e+01, 5.4000e+02, 1.7500e+02, 4.7000e+02,\n         1.0900e+02, 4.0000e+02, 7.7300e+02, 7.7000e+02, 6.2800e+02, 7.7500e+02,\n         7.7500e+02, 2.4200e+02, 2.4200e+02, 7.6500e+02, 8.0000e+01, 1.1000e+02,\n         7.5200e+02, 7.5200e+02, 2.6800e+02, 2.3800e+02, 7.1700e+02, 7.2900e+02,\n         8.0000e+00, 7.6300e+02, 7.7100e+02, 7.6300e+02, 7.7700e+02, 7.6500e+02,\n         7.7400e+02, 7.7400e+02, 5.1000e+01, 7.0400e+02, 0.0000e+00, 7.3300e+02,\n         7.7600e+02, 1.3200e+02, 4.5000e+01, 3.0000e+00, 1.4100e+02, 7.0100e+02,\n         7.7400e+02, 2.5500e+02, 7.3400e+02, 2.7500e+02, 7.0700e+02, 7.1500e+02,\n         7.3000e+01, 7.1300e+02, 7.7000e+02, 8.1000e+01, 7.6700e+02, 7.8200e+02,\n         2.0000e+00, 7.8100e+02, 1.5400e+02, 1.1000e+01, 6.1700e+02, 4.3000e+01,\n         6.4000e+01, 5.2000e+01, 7.2000e+02, 1.1000e+01, 3.7300e+02, 7.7400e+02,\n         6.8500e+02, 7.7700e+02, 7.4600e+02, 7.7800e+02, 7.6900e+02, 7.7400e+02,\n         2.5100e+02, 2.5100e+02, 6.8500e+02, 5.7100e+02, 4.7300e+02, 7.6700e+02,\n         7.8200e+02, 2.0000e+00, 1.0000e+00, 7.0700e+02, 1.4000e+02, 3.4000e+01,\n         3.4000e+01],\n        [7.0000e+01, 7.2700e+02, 1.0000e+00, 2.0000e+00, 2.0000e+00, 7.0000e+00,\n         5.7000e+01, 1.1300e+03, 1.9000e+01, 2.2730e+03, 2.0000e+00, 1.8000e+01,\n         8.7000e+01, 3.8500e+02, 2.9300e+02, 5.9000e+01, 4.9000e+01, 5.6000e+01,\n         4.7000e+01, 4.0000e+00, 0.0000e+00, 7.6000e+01, 6.8000e+01, 3.0000e+00,\n         1.8500e+02, 1.9800e+02, 2.2710e+03, 2.2740e+03, 2.2690e+03, 4.2200e+02,\n         1.4580e+03, 2.0000e+00, 5.7000e+01, 1.0940e+03, 7.6700e+02, 7.6500e+02,\n         7.5900e+02, 7.5000e+02, 3.0100e+02, 7.1100e+02, 6.8500e+02, 5.6200e+02,\n         7.1000e+02, 7.0400e+02, 6.2600e+02, 5.8000e+01, 6.8000e+02, 6.9300e+02,\n         6.9200e+02, 6.3200e+02, 2.2000e+01, 5.4100e+02, 2.1200e+02, 4.7300e+02,\n         1.1100e+02, 4.0300e+02, 7.5900e+02, 7.6000e+02, 6.2600e+02, 7.4200e+02,\n         7.4200e+02, 4.0000e+02, 4.0000e+02, 7.5400e+02, 1.6000e+02, 1.8900e+02,\n         7.0400e+02, 7.0400e+02, 4.2800e+02, 3.7700e+02, 7.0100e+02, 7.0900e+02,\n         8.8000e+01, 7.6700e+02, 7.6000e+02, 7.6700e+02, 7.6600e+02, 7.5400e+02,\n         7.6100e+02, 7.6100e+02, 5.8000e+01, 6.8000e+02, 0.0000e+00, 7.2600e+02,\n         7.7200e+02, 2.1600e+02, 1.8700e+02, 6.9000e+01, 3.1200e+02, 5.6600e+02,\n         7.4000e+02, 3.0600e+02, 7.0600e+02, 4.3200e+02, 6.9300e+02, 6.9100e+02,\n         9.1000e+01, 6.9300e+02, 7.5900e+02, 1.1700e+02, 7.2400e+02, 7.5600e+02,\n         3.1000e+01, 7.5200e+02, 1.7900e+02, 4.3000e+01, 5.7300e+02, 9.2000e+01,\n         1.0900e+02, 9.7000e+01, 6.9700e+02, 1.6400e+02, 5.1600e+02, 7.5500e+02,\n         7.1800e+02, 7.6000e+02, 7.5200e+02, 7.4600e+02, 7.3000e+02, 7.3800e+02,\n         2.1200e+02, 2.1200e+02, 6.4900e+02, 5.7200e+02, 5.8000e+02, 7.2200e+02,\n         7.5600e+02, 3.2000e+01, 2.5000e+01, 6.9300e+02, 3.2600e+02, 4.1000e+01,\n         4.1000e+01]])\nTargets: tensor([ 558.,  660.,  636., 1220.,  308.])\n```\n:::\n:::\n\n\n:::\n## Step 4: Preprocessing {#sec-preprocessing-33}\n\nPreprocessing is handled by `Lightning` and `PyTorch`. It is described in the [LIGHTNINGDATAMODULE](https://lightning.ai/docs/pytorch/stable/data/datamodule.html) documentation. Here you can find information about the `transforms` methods.\n\n## Step 5: Select the Core Model (`algorithm`) and `core_model_hyper_dict` {#sec-selection-of-the-algorithm-33}\n\n`spotPython` includes the `NetLightRegression` class [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/light/netlightregression.py) for configurable neural networks. \nThe class is imported here. It inherits from the class `Lightning.LightningModule`, which is the base class for all models in `Lightning`. `Lightning.LightningModule` is a subclass of `torch.nn.Module` and provides additional functionality for the training and testing of neural networks. The class `Lightning.LightningModule` is described in the [Lightning documentation](https://lightning.ai/docs/pytorch/stable/common/lightning_module.html).\n\n* Here we simply add the NN Model to the fun_control dictionary by calling the function `add_core_model_to_fun_control`:\n\nWe can use aconfiguration from the `spotPython` package:\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nfrom spotPython.light.regression.netlightregression import NetLightRegression\nfrom spotPython.hyperdict.light_hyper_dict import LightHyperDict\nfrom spotPython.hyperparameters.values import add_core_model_to_fun_control\nadd_core_model_to_fun_control(fun_control=fun_control,\n                              core_model=NetLightRegression,\n                              hyper_dict=LightHyperDict)\n```\n:::\n\n\n* Alternatively, we can use a userr configuration from the subdirectory `userModel`:\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nfrom spotPython.hyperparameters.values import add_core_model_to_fun_control\nimport sys\nsys.path.insert(0, './userModel')\nimport netlightregression\nimport light_hyper_dict\nadd_core_model_to_fun_control(fun_control=fun_control,\n                              core_model=netlightregression.NetLightRegression,\n                              hyper_dict=light_hyper_dict.LightHyperDict)\n```\n:::\n\n\nThe hyperparameters of the model are specified in the `core_model_hyper_dict` dictionary [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/hyperdict/light_hyper_dict.json).\n\n\n\n## Step 6: Modify `hyper_dict` Hyperparameters for the Selected Algorithm aka `core_model` {#sec-modification-of-hyperparameters-33}\n\n `spotPython` provides functions for modifying the hyperparameters, their bounds and factors as well as for activating and de-activating hyperparameters without re-compilation of the Python source code. \n\n::: {.callout-caution}\n### Caution: Small number of epochs for demonstration purposes\n\n* `epochs` and `patience` are set to small values for demonstration purposes. These values are too small for a real application.\n* More resonable values are, e.g.:\n  * `set_control_hyperparameter_value(fun_control, \"epochs\", [7, 9])` and\n  * `set_control_hyperparameter_value(fun_control, \"patience\", [2, 7])`\n\n:::\n\n::: {.callout-note}\n#### Note: Pre-experimental Results\n\n* The following hyperparameters {@tbl-pre-experimental-results-33} have generated acceptable results (obtained in in pre-experimental runs):\n\n| Hyperparameter | Value |\n|----------------|-------|\n| `act_fn` | `LeakyReLU` |\n| `batch_size` | `16` |\n| `dropout_prob` | `0.01` |\n| `epochs` | `512` |\n| `initialization` | `Default` |\n| `l1` | `128` |\n| `lr_mult` | `0.5` |\n| `optimizer` | `Adagrad` |\n| `patience` | `16` |\n\n: Table 1: Pre-experimental results for the user specified data set. The test set size is 715, the train set size is 1167, and the batch size is 16. {#tbl-pre-experimental-results-33}\n\nTherefore, we will use these values as the starting poing for the hyperparameter tuning.\n\n:::\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nfrom spotPython.hyperparameters.values import set_control_hyperparameter_value\n\nset_control_hyperparameter_value(fun_control, \"l1\", [5, 9])\nset_control_hyperparameter_value(fun_control, \"epochs\", [5, 10])\nset_control_hyperparameter_value(fun_control, \"batch_size\", [3, 6])\nset_control_hyperparameter_value(fun_control, \"optimizer\", [\n                \"Adadelta\",\n                \"Adamax\",\n                \"Adagrad\"\n            ])\nset_control_hyperparameter_value(fun_control, \"dropout_prob\", [0.005, 0.25])\nset_control_hyperparameter_value(fun_control, \"lr_mult\", [0.25, 5.0])\nset_control_hyperparameter_value(fun_control, \"patience\", [3,5])\nset_control_hyperparameter_value(fun_control, \"act_fn\",[\n                \"ReLU\",\n                \"LeakyReLU\",\n            ] )\nset_control_hyperparameter_value(fun_control, \"initialization\",[\"Default\"] )\n```\n:::\n\n\nNow, the dictionary `fun_control` contains all information needed for the hyperparameter tuning. Before the hyperparameter tuning is started, it is recommended to take a look at the experimental design. The method `gen_design_table` [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/utils/eda.py) generates a design table as follows:\n\n::: {.cell fig-label='tbl-design-33' execution_count=8}\n``` {.python .cell-code}\nfrom spotPython.utils.eda import gen_design_table\nprint(gen_design_table(fun_control))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n| name           | type   | default   |   lower |   upper | transform             |\n|----------------|--------|-----------|---------|---------|-----------------------|\n| l1             | int    | 3         |   5     |    9    | transform_power_2_int |\n| epochs         | int    | 4         |   5     |   10    | transform_power_2_int |\n| batch_size     | int    | 4         |   3     |    6    | transform_power_2_int |\n| act_fn         | factor | ReLU      |   0     |    1    | None                  |\n| optimizer      | factor | SGD       |   0     |    2    | None                  |\n| dropout_prob   | float  | 0.01      |   0.005 |    0.25 | None                  |\n| lr_mult        | float  | 1.0       |   0.25  |    5    | None                  |\n| patience       | int    | 2         |   3     |    5    | transform_power_2_int |\n| initialization | factor | Default   |   0     |    0    | None                  |\n```\n:::\n:::\n\n\nThis allows to check if all information is available and if the information is correct.\n\n::: {.callout-note}\n### Note: Hyperparameters of the Tuned Model and the `fun_control` Dictionary\nThe updated `fun_control` dictionary can be shown with the command `fun_control[\"core_model_hyper_dict\"]`.\n:::\n\n\n## Step 7: Data Splitting, the Objective (Loss) Function and the Metric\n\n### Evaluation  {#sec-selection-of-target-function-33}\n\nThe evaluation procedure requires the specification of two elements:\n\n1. the way how the data is split into a train and a test set\n2. the loss function (and a metric).\n\n::: {.callout-caution}\n### Caution: Data Splitting in Lightning\n\nThe data splitting is handled by `Lightning`.\n\n:::\n\n### Loss Function {#sec-loss-function-33}\n\nThe loss function is specified in the configurable network class [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/light/regression/netlightregression.py)\nWe will use MSE.\n\n### Metric {#sec-metric-33}\n\n* Similar to the loss function, the metric is specified in the configurable network class [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/light/regression/netlightregression.py).\n\n::: {.callout-caution}\n### Caution: Loss Function and Metric in Lightning\n\n* The loss function and the metric are not hyperparameters that can be tuned with `spotPython`.\n* They are handled by `Lightning`.\n\n:::\n\n\n## Step 8: Calling the SPOT Function\n\n### Preparing the SPOT Call {#sec-prepare-spot-call-33}\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nfrom spotPython.utils.init import design_control_init, surrogate_control_init\ndesign_control = design_control_init(init_size=INIT_SIZE,\n                                     repeats=REPEATS,)\n\nsurrogate_control = surrogate_control_init(noise=True,\n                                            n_theta=2,\n                                            min_Lambda=1e-6,\n                                            max_Lambda=10,\n                                            log_level=10,)\n```\n:::\n\n\n::: {.callout-note}\n### Note: Modifying Values in the Control Dictionaries \n\n* The values in the control dictionaries can be modified with the function `set_control_key_value` [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/hyperparameters/values.py), for example:\n\n\n\n```{raw}\nset_control_key_value(control_dict=surrogate_control,\n                        key=\"noise\",\n                        value=True,\n                        replace=True)                       \nset_control_key_value(control_dict=surrogate_control,\n                        key=\"n_theta\",\n                        value=2,\n                        replace=True)      \n\n```\n\n\n:::\n\n### The Objective Function `fun` {#sec-the-objective-function-33}\n\nThe objective function `fun` from the class `HyperLight` [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/fun/hyperlight.py) is selected next. It implements an interface from `PyTorch`'s training, validation, and testing methods to `spotPython`.\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nfrom spotPython.fun.hyperlight import HyperLight\nfun = HyperLight(log_level=10).fun\n```\n:::\n\n\n### Showing the fun_control Dictionary {#sec-show-fun-control-33}\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nimport pprint\npprint.pprint(fun_control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{'CHECKPOINT_PATH': 'runs/saved_models/',\n 'DATASET_PATH': 'data/',\n 'RESULTS_PATH': 'results/',\n 'TENSORBOARD_PATH': 'runs/',\n '_L_in': 133,\n '_L_out': 1,\n 'accelerator': 'auto',\n 'core_model': <class 'netlightregression.NetLightRegression'>,\n 'core_model_hyper_dict': {'act_fn': {'class_name': 'spotPython.torch.activation',\n                                      'core_model_parameter_type': 'instance()',\n                                      'default': 'ReLU',\n                                      'levels': ['ReLU', 'LeakyReLU'],\n                                      'lower': 0,\n                                      'transform': 'None',\n                                      'type': 'factor',\n                                      'upper': 1},\n                           'batch_size': {'default': 4,\n                                          'lower': 3,\n                                          'transform': 'transform_power_2_int',\n                                          'type': 'int',\n                                          'upper': 6},\n                           'dropout_prob': {'default': 0.01,\n                                            'lower': 0.005,\n                                            'transform': 'None',\n                                            'type': 'float',\n                                            'upper': 0.25},\n                           'epochs': {'default': 4,\n                                      'lower': 5,\n                                      'transform': 'transform_power_2_int',\n                                      'type': 'int',\n                                      'upper': 10},\n                           'initialization': {'core_model_parameter_type': 'str',\n                                              'default': 'Default',\n                                              'levels': ['Default'],\n                                              'lower': 0,\n                                              'transform': 'None',\n                                              'type': 'factor',\n                                              'upper': 0},\n                           'l1': {'default': 3,\n                                  'lower': 5,\n                                  'transform': 'transform_power_2_int',\n                                  'type': 'int',\n                                  'upper': 9},\n                           'lr_mult': {'default': 1.0,\n                                       'lower': 0.25,\n                                       'transform': 'None',\n                                       'type': 'float',\n                                       'upper': 5.0},\n                           'optimizer': {'class_name': 'torch.optim',\n                                         'core_model_parameter_type': 'str',\n                                         'default': 'SGD',\n                                         'levels': ['Adadelta',\n                                                    'Adamax',\n                                                    'Adagrad'],\n                                         'lower': 0,\n                                         'transform': 'None',\n                                         'type': 'factor',\n                                         'upper': 2},\n                           'patience': {'default': 2,\n                                        'lower': 3,\n                                        'transform': 'transform_power_2_int',\n                                        'type': 'int',\n                                        'upper': 5}},\n 'counter': 0,\n 'data': None,\n 'data_dir': './data',\n 'data_module': None,\n 'data_set': <spotPython.data.pkldataset.PKLDataset object at 0x2cea1f090>,\n 'design': None,\n 'device': 'mps',\n 'devices': 1,\n 'enable_progress_bar': False,\n 'eval': None,\n 'fun_evals': inf,\n 'fun_repeats': 2,\n 'infill_criterion': 'y',\n 'k_folds': 3,\n 'log_level': 10,\n 'loss_function': None,\n 'lower': array([3. , 4. , 1. , 0. , 0. , 0. , 0.1, 2. , 0. ]),\n 'max_time': 10,\n 'metric_params': {},\n 'metric_river': None,\n 'metric_sklearn': None,\n 'metric_torch': None,\n 'model_dict': {},\n 'n_points': 1,\n 'n_samples': None,\n 'noise': False,\n 'num_workers': 0,\n 'ocba_delta': 1,\n 'optimizer': None,\n 'path': None,\n 'prep_model': None,\n 'save_model': False,\n 'seed': 123,\n 'show_batch_interval': 1000000,\n 'show_models': False,\n 'show_progress': True,\n 'shuffle': None,\n 'sigma': 0.0,\n 'spot_tensorboard_path': 'runs/spot_logs/032_p040025_2024-01-15_03-37-22',\n 'spot_writer': <torch.utils.tensorboard.writer.SummaryWriter object at 0x2c8a313d0>,\n 'target_column': None,\n 'task': None,\n 'test': None,\n 'test_seed': 1234,\n 'test_size': 0.3,\n 'tolerance_x': 1.4901161193847656e-08,\n 'train': None,\n 'upper': array([ 8.  ,  9.  ,  4.  ,  5.  , 11.  ,  0.25, 10.  ,  6.  ,  2.  ]),\n 'var_name': ['l1',\n              'epochs',\n              'batch_size',\n              'act_fn',\n              'optimizer',\n              'dropout_prob',\n              'lr_mult',\n              'patience',\n              'initialization'],\n 'var_type': ['int',\n              'int',\n              'int',\n              'factor',\n              'factor',\n              'float',\n              'float',\n              'int',\n              'factor'],\n 'verbosity': 1,\n 'weights': 1.0}\n```\n:::\n:::\n\n\n### Starting the Hyperparameter Tuning {#sec-call-the-hyperparameter-tuner-33}\n\nThe `spotPython` hyperparameter tuning is started by calling the `Spot` function [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/spot/spot.py).\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nfrom spotPython.spot import spot\nspot_tuner = spot.Spot(fun=fun,\n                       fun_control=fun_control,\n                       design_control=design_control,\n                       surrogate_control=surrogate_control)\nspot_tuner.run()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.20560368458693354,\n 'epochs': 128,\n 'initialization': 'Default',\n 'l1': 64,\n 'lr_mult': 4.561411125937148,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 9691.404296875, 'hp_metric': 9691.404296875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.20560368458693354,\n 'epochs': 128,\n 'initialization': 'Default',\n 'l1': 64,\n 'lr_mult': 4.561411125937148,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 82330.359375, 'hp_metric': 82330.359375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.02426280739731016,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.322803150188513,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5680.0966796875, 'hp_metric': 5680.0966796875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.02426280739731016,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.322803150188513,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2287.1826171875, 'hp_metric': 2287.1826171875}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 8,\n 'dropout_prob': 0.07443535216560176,\n 'epochs': 512,\n 'initialization': 'Default',\n 'l1': 32,\n 'lr_mult': 2.863550239963548,\n 'optimizer': 'Adamax',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 8\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 8\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 45320.10546875, 'hp_metric': 45320.10546875}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 8,\n 'dropout_prob': 0.07443535216560176,\n 'epochs': 512,\n 'initialization': 'Default',\n 'l1': 32,\n 'lr_mult': 2.863550239963548,\n 'optimizer': 'Adamax',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 8\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 8\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 44621.0390625, 'hp_metric': 44621.0390625}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.18567441685948113,\n 'epochs': 64,\n 'initialization': 'Default',\n 'l1': 64,\n 'lr_mult': 4.089366778039889,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 109158.8515625, 'hp_metric': 109158.8515625}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.18567441685948113,\n 'epochs': 64,\n 'initialization': 'Default',\n 'l1': 64,\n 'lr_mult': 4.089366778039889,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 151683.59375, 'hp_metric': 151683.59375}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.13080206803532848,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 2.0077669995722074,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 8908.8837890625, 'hp_metric': 8908.8837890625}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.13080206803532848,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 2.0077669995722074,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 16831.779296875, 'hp_metric': 16831.779296875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.11983781472185623,\n 'epochs': 1024,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 0.7181246235247182,\n 'optimizer': 'Adadelta',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 170177.1875, 'hp_metric': 170177.1875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 32,\n 'dropout_prob': 0.11983781472185623,\n 'epochs': 1024,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 0.7181246235247182,\n 'optimizer': 'Adadelta',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 32\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 32\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 4781.1748046875, 'hp_metric': 4781.1748046875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.09366384017851244,\n 'epochs': 64,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 3.301460285082441,\n 'optimizer': 'Adadelta',\n 'patience': 32}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 363511.125, 'hp_metric': 363511.125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.09366384017851244,\n 'epochs': 64,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 3.301460285082441,\n 'optimizer': 'Adadelta',\n 'patience': 32}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 18567.58203125, 'hp_metric': 18567.58203125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.03540914713540524,\n 'epochs': 32,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 3.7811076839948083,\n 'optimizer': 'Adamax',\n 'patience': 32}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2381.155517578125, 'hp_metric': 2381.155517578125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.03540914713540524,\n 'epochs': 32,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 3.7811076839948083,\n 'optimizer': 'Adamax',\n 'patience': 32}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 1633.8154296875, 'hp_metric': 1633.8154296875}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.23933451103594558,\n 'epochs': 128,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 0.9693203335370014,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 19519.423828125, 'hp_metric': 19519.423828125}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.23933451103594558,\n 'epochs': 128,\n 'initialization': 'Default',\n 'l1': 128,\n 'lr_mult': 0.9693203335370014,\n 'optimizer': 'Adamax',\n 'patience': 8}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 6648.47900390625, 'hp_metric': 6648.47900390625}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.15827496187066842,\n 'epochs': 512,\n 'initialization': 'Default',\n 'l1': 512,\n 'lr_mult': 2.4208305977937328,\n 'optimizer': 'Adamax',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 6104.76220703125, 'hp_metric': 6104.76220703125}\n\nIn fun(): config:\n{'act_fn': ReLU(),\n 'batch_size': 16,\n 'dropout_prob': 0.15827496187066842,\n 'epochs': 512,\n 'initialization': 'Default',\n 'l1': 512,\n 'lr_mult': 2.4208305977937328,\n 'optimizer': 'Adamax',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 16\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 16\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2992.532958984375, 'hp_metric': 2992.532958984375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.04825016876158548,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4769991072624946,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2337.91748046875, 'hp_metric': 2337.91748046875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.04825016876158548,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4769991072624946,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3264.527099609375, 'hp_metric': 3264.527099609375}\nspotPython tuning: 1633.8154296875 [#---------] 7.76% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05037009219038317,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.490628647450869,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 1807.1495361328125, 'hp_metric': 1807.1495361328125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05037009219038317,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.490628647450869,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3191.741943359375, 'hp_metric': 3191.741943359375}\nspotPython tuning: 1633.8154296875 [#---------] 14.46% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05260472442202331,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.505002772751222,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 8475.75, 'hp_metric': 8475.75}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05260472442202331,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.505002772751222,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5522.3935546875, 'hp_metric': 5522.3935546875}\nspotPython tuning: 1633.8154296875 [##--------] 18.76% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05413475936399615,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5148817736749298,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3902.89501953125, 'hp_metric': 3902.89501953125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05413475936399615,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5148817736749298,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2615.920654296875, 'hp_metric': 2615.920654296875}\nspotPython tuning: 1633.8154296875 [##--------] 22.57% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055933023612466014,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5264365695558901,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3183.96435546875, 'hp_metric': 3183.96435546875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055933023612466014,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5264365695558901,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 56039.2890625, 'hp_metric': 56039.2890625}\nspotPython tuning: 1633.8154296875 [###-------] 27.11% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05263943958400707,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5052098265780478,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2725.66357421875, 'hp_metric': 2725.66357421875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05263943958400707,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5052098265780478,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 6538.43310546875, 'hp_metric': 6538.43310546875}\nspotPython tuning: 1633.8154296875 [###-------] 30.52% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05316632156290128,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5086702767555806,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5130.96630859375, 'hp_metric': 5130.96630859375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05316632156290128,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5086702767555806,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2350.8046875, 'hp_metric': 2350.8046875}\nspotPython tuning: 1633.8154296875 [###-------] 34.35% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.053771679137023694,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5124802181853274,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 10390.2138671875, 'hp_metric': 10390.2138671875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.053771679137023694,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5124802181853274,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2203.74755859375, 'hp_metric': 2203.74755859375}\nspotPython tuning: 1633.8154296875 [####------] 40.11% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05402750909623282,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5141703050361923,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3288.8427734375, 'hp_metric': 3288.8427734375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05402750909623282,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5141703050361923,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5342.2548828125, 'hp_metric': 5342.2548828125}\nspotPython tuning: 1633.8154296875 [####------] 44.19% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05448797256538013,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5170610907476367,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 1620.1785888671875, 'hp_metric': 1620.1785888671875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05448797256538013,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5170610907476367,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3572.1640625, 'hp_metric': 3572.1640625}\nspotPython tuning: 1620.1785888671875 [#####-----] 48.67% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055174351358467405,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5215060127606514,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2750.79541015625, 'hp_metric': 2750.79541015625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055174351358467405,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5215060127606514,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5175.3466796875, 'hp_metric': 5175.3466796875}\nspotPython tuning: 1620.1785888671875 [#####-----] 53.28% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055696958537016866,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.524867959583039,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5328.39404296875, 'hp_metric': 5328.39404296875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.055696958537016866,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.524867959583039,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5937.96533203125, 'hp_metric': 5937.96533203125}\nspotPython tuning: 1620.1785888671875 [######----] 58.84% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05589887172269804,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.526150803701278,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2388.19189453125, 'hp_metric': 2388.19189453125}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05589887172269804,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.526150803701278,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 7502.37548828125, 'hp_metric': 7502.37548828125}\nspotPython tuning: 1620.1785888671875 [#######---] 65.69% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.0562113034404144,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5280954720377455,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 36894.0625, 'hp_metric': 36894.0625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.0562113034404144,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5280954720377455,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 5805.9248046875, 'hp_metric': 5805.9248046875}\nspotPython tuning: 1620.1785888671875 [#######---] 68.86% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.052806491168032314,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5067848529726446,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 9569.8994140625, 'hp_metric': 9569.8994140625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.052806491168032314,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5067848529726446,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3403.76953125, 'hp_metric': 3403.76953125}\nspotPython tuning: 1620.1785888671875 [########--] 75.34% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05245253149077113,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5040814155528057,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 4728.78515625, 'hp_metric': 4728.78515625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05245253149077113,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.5040814155528057,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 12009.7314453125, 'hp_metric': 12009.7314453125}\nspotPython tuning: 1620.1785888671875 [########--] 79.78% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05196894703679841,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.501019508422615,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3601.85400390625, 'hp_metric': 3601.85400390625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05196894703679841,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.501019508422615,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 12909.5517578125, 'hp_metric': 12909.5517578125}\nspotPython tuning: 1620.1785888671875 [########--] 84.37% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.051474986340905554,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4979255024445266,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2890.673583984375, 'hp_metric': 2890.673583984375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.051474986340905554,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4979255024445266,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 4002.3369140625, 'hp_metric': 4002.3369140625}\nspotPython tuning: 1620.1785888671875 [#########-] 88.33% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05080741682078949,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4935919826787676,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 3963.92041015625, 'hp_metric': 3963.92041015625}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.05080741682078949,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4935919826787676,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 6113.154296875, 'hp_metric': 6113.154296875}\nspotPython tuning: 1620.1785888671875 [#########-] 92.56% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.050055475077940365,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4887675150407989,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 6603.4912109375, 'hp_metric': 6603.4912109375}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.050055475077940365,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4887675150407989,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 2470.803955078125, 'hp_metric': 2470.803955078125}\nspotPython tuning: 1620.1785888671875 [##########] 96.64% \r\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.04912791894409341,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4828174957876712,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 9845.26171875, 'hp_metric': 9845.26171875}\n\nIn fun(): config:\n{'act_fn': LeakyReLU(),\n 'batch_size': 64,\n 'dropout_prob': 0.04912791894409341,\n 'epochs': 256,\n 'initialization': 'Default',\n 'l1': 256,\n 'lr_mult': 1.4828174957876712,\n 'optimizer': 'Adagrad',\n 'patience': 16}\ntrain_model(): Test set size: 715\ntrain_model(): Train set size: 1167\ntrain_model(): Batch size: 64\nLightDataModule: train_dataloader(). Training set size: 1167\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\ntrain_model result: {'val_loss': 8919.93359375, 'hp_metric': 8919.93359375}\nspotPython tuning: 1620.1785888671875 [##########] 100.00% Done...\r\n\r\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               9691.404296875       \n         val_loss                9691.404296875       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                82330.359375        \n         val_loss                 82330.359375        \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               5680.0966796875      \n         val_loss                5680.0966796875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               2287.1826171875      \n         val_loss                2287.1826171875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               45320.10546875       \n         val_loss                45320.10546875       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                44621.0390625       \n         val_loss                 44621.0390625       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               109158.8515625       \n         val_loss                109158.8515625       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                151683.59375        \n         val_loss                 151683.59375        \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               8908.8837890625      \n         val_loss                8908.8837890625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               16831.779296875      \n         val_loss                16831.779296875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                 170177.1875        \n         val_loss                  170177.1875        \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               4781.1748046875      \n         val_loss                4781.1748046875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                 363511.125         \n         val_loss                  363511.125         \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               18567.58203125       \n         val_loss                18567.58203125       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2381.155517578125     \n         val_loss               2381.155517578125     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               1633.8154296875      \n         val_loss                1633.8154296875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               19519.423828125      \n         val_loss                19519.423828125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              6648.47900390625      \n         val_loss               6648.47900390625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              6104.76220703125      \n         val_loss               6104.76220703125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2992.532958984375     \n         val_loss               2992.532958984375     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2337.91748046875      \n         val_loss               2337.91748046875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3264.527099609375     \n         val_loss               3264.527099609375     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric             1807.1495361328125     \n         val_loss              1807.1495361328125     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3191.741943359375     \n         val_loss               3191.741943359375     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                   8475.75          \n         val_loss                    8475.75          \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               5522.3935546875      \n         val_loss                5522.3935546875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3902.89501953125      \n         val_loss               3902.89501953125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2615.920654296875     \n         val_loss               2615.920654296875     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3183.96435546875      \n         val_loss               3183.96435546875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                56039.2890625       \n         val_loss                 56039.2890625       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2725.66357421875      \n         val_loss               2725.66357421875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              6538.43310546875      \n         val_loss               6538.43310546875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              5130.96630859375      \n         val_loss               5130.96630859375      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                2350.8046875        \n         val_loss                 2350.8046875        \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              10390.2138671875      \n         val_loss               10390.2138671875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2203.74755859375      \n         val_loss               2203.74755859375      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               3288.8427734375      \n         val_loss                3288.8427734375      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               5342.2548828125      \n         val_loss                5342.2548828125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric             1620.1785888671875     \n         val_loss              1620.1785888671875     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                3572.1640625        \n         val_loss                 3572.1640625        \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2750.79541015625      \n         val_loss               2750.79541015625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               5175.3466796875      \n         val_loss                5175.3466796875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              5328.39404296875      \n         val_loss               5328.39404296875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              5937.96533203125      \n         val_loss               5937.96533203125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2388.19189453125      \n         val_loss               2388.19189453125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              7502.37548828125      \n         val_loss               7502.37548828125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                 36894.0625         \n         val_loss                  36894.0625         \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               5805.9248046875      \n         val_loss                5805.9248046875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               9569.8994140625      \n         val_loss                9569.8994140625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                3403.76953125       \n         val_loss                 3403.76953125       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                4728.78515625       \n         val_loss                 4728.78515625       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              12009.7314453125      \n         val_loss               12009.7314453125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3601.85400390625      \n         val_loss               3601.85400390625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              12909.5517578125      \n         val_loss               12909.5517578125      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2890.673583984375     \n         val_loss               2890.673583984375     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               4002.3369140625      \n         val_loss                4002.3369140625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              3963.92041015625      \n         val_loss               3963.92041015625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               6113.154296875       \n         val_loss                6113.154296875       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               6603.4912109375      \n         val_loss                6603.4912109375      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              2470.803955078125     \n         val_loss               2470.803955078125     \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                9845.26171875       \n         val_loss                 9845.26171875       \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric                8919.93359375       \n         val_loss                 8919.93359375       \n\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\n<spotPython.spot.spot.Spot at 0x2d337c750>\n```\n:::\n:::\n\n\n## Step 9: Tensorboard {#sec-tensorboard-33}\n\nThe textual output shown in the console (or code cell) can be visualized with Tensorboard.\n\n\n\n```{raw}\ntensorboard --logdir=\"runs/\"\n```\n\n\n\nFurther information can be found in the [PyTorch Lightning documentation](https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.loggers.tensorboard.html) for Tensorboard.\n\n\n\n## Step 10: Results {#sec-results-33}\n\nAfter the hyperparameter tuning run is finished, the results can be analyzed.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nif spot_tuner.noise:\n    print(spot_tuner.min_mean_X)\n    print(spot_tuner.min_mean_y)\nelse:\n    print(spot_tuner.min_X)\n    print(spot_tuner.min_y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[8.         8.         6.         1.         2.         0.05448797\n 1.51706109 4.        ]\n1620.1785888671875\n```\n:::\n:::\n\n\n::: {.cell fig-label='fig-progress-33' execution_count=14}\n``` {.python .cell-code}\nspot_tuner.plot_progress(log_y=False,\n    filename=\"./figures/\" + PREFIX +\"_progress.png\")\n```\n\n::: {.cell-output .cell-output-display}\n![Progress plot. *Black* dots denote results from the initial design. *Red* dots  illustrate the improvement found by the surrogate model based optimization.](033_spot_lightning_linear_sensitive_files/figure-pdf/cell-15-output-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n::: {.cell fig-label='tbl-results-33' execution_count=15}\n``` {.python .cell-code}\nfrom spotPython.utils.eda import gen_design_table\nprint(gen_design_table(fun_control=fun_control, spot=spot_tuner))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n| name           | type   | default   |   lower |   upper | tuned               | transform             |   importance | stars   |\n|----------------|--------|-----------|---------|---------|---------------------|-----------------------|--------------|---------|\n| l1             | int    | 3         |     5.0 |     9.0 | 8.0                 | transform_power_2_int |         0.00 |         |\n| epochs         | int    | 4         |     5.0 |    10.0 | 8.0                 | transform_power_2_int |        79.92 | **      |\n| batch_size     | int    | 4         |     3.0 |     6.0 | 6.0                 | transform_power_2_int |         0.00 |         |\n| act_fn         | factor | ReLU      |     0.0 |     1.0 | LeakyReLU           | None                  |         0.01 |         |\n| optimizer      | factor | SGD       |     0.0 |     2.0 | Adagrad             | None                  |       100.00 | ***     |\n| dropout_prob   | float  | 0.01      |   0.005 |    0.25 | 0.05448797256538013 | None                  |         0.01 |         |\n| lr_mult        | float  | 1.0       |    0.25 |     5.0 | 1.5170610907476367  | None                  |         0.00 |         |\n| patience       | int    | 2         |     3.0 |     5.0 | 4.0                 | transform_power_2_int |         0.00 |         |\n| initialization | factor | Default   |     0.0 |     0.0 | Default             | None                  |         0.00 |         |\n```\n:::\n:::\n\n\n::: {.cell fig-label='fig-importance-33' execution_count=16}\n``` {.python .cell-code}\nspot_tuner.plot_importance(threshold=0.025,\n    filename=\"./figures/\" + PREFIX + \"_importance.png\")\n```\n\n::: {.cell-output .cell-output-display}\n![Variable importance plot, threshold 0.025.](033_spot_lightning_linear_sensitive_files/figure-pdf/cell-17-output-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n### Get the Tuned Architecture {#sec-get-spot-results-33}\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\nfrom spotPython.hyperparameters.values import get_tuned_architecture\nconfig = get_tuned_architecture(spot_tuner, fun_control)\nprint(config)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{'l1': 256, 'epochs': 256, 'batch_size': 64, 'act_fn': LeakyReLU(), 'optimizer': 'Adagrad', 'dropout_prob': 0.05448797256538013, 'lr_mult': 1.5170610907476367, 'patience': 16, 'initialization': 'Default'}\n```\n:::\n:::\n\n\n* Test on the full data set\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\nfrom spotPython.light.testmodel import test_model\ntest_model(config, fun_control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLightDataModule: train_dataloader(). Training set size: 381\nLightDataModule: train_dataloader(). batch_size: 64\nLightDataModule: train_dataloader(). num_workers: 0\nLightDataModule: test_dataloader(). Training set size: 1429\nLightDataModule: test_dataloader(). batch_size: 64\nLightDataModule: test_dataloader(). num_workers: 0\ntest_model result: {'val_loss': 6563.67822265625, 'hp_metric': 6563.67822265625}\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n        Test metric               DataLoader 0        \n\n         hp_metric              6563.67822265625      \n         val_loss               6563.67822265625      \n\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\n(6563.67822265625, 6563.67822265625)\n```\n:::\n:::\n\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\nfrom spotPython.light.loadmodel import load_light_from_checkpoint\n\nmodel_loaded = load_light_from_checkpoint(config, fun_control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nconfig: {'l1': 256, 'epochs': 256, 'batch_size': 64, 'act_fn': LeakyReLU(), 'optimizer': 'Adagrad', 'dropout_prob': 0.05448797256538013, 'lr_mult': 1.5170610907476367, 'patience': 16, 'initialization': 'Default'}\nLoading model with 256_256_64_LeakyReLU_Adagrad_0.0545_1.5171_16_Default_TEST from runs/saved_models/256_256_64_LeakyReLU_Adagrad_0.0545_1.5171_16_Default_TEST/last.ckpt\nModel: NetLightRegression(\n  (layers): Sequential(\n    (0): Linear(in_features=133, out_features=256, bias=True)\n    (1): LeakyReLU()\n    (2): Dropout(p=0.05448797256538013, inplace=False)\n    (3): Linear(in_features=256, out_features=128, bias=True)\n    (4): LeakyReLU()\n    (5): Dropout(p=0.05448797256538013, inplace=False)\n    (6): Linear(in_features=128, out_features=128, bias=True)\n    (7): LeakyReLU()\n    (8): Dropout(p=0.05448797256538013, inplace=False)\n    (9): Linear(in_features=128, out_features=64, bias=True)\n    (10): LeakyReLU()\n    (11): Dropout(p=0.05448797256538013, inplace=False)\n    (12): Linear(in_features=64, out_features=1, bias=True)\n  )\n)\n```\n:::\n:::\n\n\n::: {.cell fig-label='fig-contour-33' execution_count=20}\n``` {.python .cell-code}\nfilename = \"./figures/\" + PREFIX\nspot_tuner.plot_important_hyperparameter_contour(filename=filename)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nepochs:  79.92198502293363\noptimizer:  100.0\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![Contour plots.](033_spot_lightning_linear_sensitive_files/figure-pdf/cell-21-output-2.pdf){fig-pos='H'}\n:::\n:::\n\n\n### Parallel Coordinates Plot\n\n::: {.cell fig-label='fig-parallel-33' execution_count=21}\n``` {.python .cell-code}\nspot_tuner.parallel_plot()\n```\n\n::: {.cell-output .cell-output-display}\n```\nUnable to display output for mime type(s): text/html\n```\n\nParallel coordinates plots\n:::\n\n::: {.cell-output .cell-output-display}\n```\nUnable to display output for mime type(s): text/html\n```\n:::\n:::\n\n\n### Cross Validation With Lightning\n\n* The `KFold` class from `sklearn.model_selection` is used to generate the folds for cross-validation.\n* These mechanism is used to generate the folds for the final evaluation of the model.\n* The `CrossValidationDataModule` class [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/data/lightcrossvalidationdatamodule.py) is used to generate the folds for the hyperparameter tuning process.\n* It is called from the `cv_model` function [[SOURCE]](https://github.com/sequential-parameter-optimization/spotPython/blob/main/src/spotPython/light/cvmodel.py).\n\n::: {.cell execution_count=22}\n``` {.python .cell-code}\nfrom spotPython.light.cvmodel import cv_model\nset_control_key_value(control_dict=fun_control,\n                        key=\"k_folds\",\n                        value=2,\n                        replace=True)\nset_control_key_value(control_dict=fun_control,\n                        key=\"test_size\",\n                        value=0.6,\n                        replace=True)\ncv_model(config, fun_control)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nk: 0\nTrain Dataset Size: 1190\nVal Dataset Size: 1191\ntrain_model result: {'val_loss': 4961.3193359375, 'hp_metric': 4961.3193359375}\nk: 1\nTrain Dataset Size: 1191\nVal Dataset Size: 1190\ntrain_model result: {'val_loss': 11453.3232421875, 'hp_metric': 11453.3232421875}\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric               4961.3193359375      \n         val_loss                4961.3193359375      \n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```\n\n      Validate metric             DataLoader 0        \n\n         hp_metric              11453.3232421875      \n         val_loss               11453.3232421875      \n\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=21}\n```\n8207.3212890625\n```\n:::\n:::\n\n\n### Plot all Combinations of Hyperparameters\n\n* Warning: this may take a while.\n\n::: {.cell execution_count=23}\n``` {.python .cell-code}\nPLOT_ALL = False\nif PLOT_ALL:\n    n = spot_tuner.k\n    for i in range(n-1):\n        for j in range(i+1, n):\n            spot_tuner.plot_contour(i=i, j=j, min_z=min_z, max_z = max_z)\n```\n:::\n\n\n### Visualizing the Activation Distribution (Under Development)\n\n::: {.callout-note}\n### Reference:\n\n* The following code is based on [[PyTorch Lightning TUTORIAL 2: ACTIVATION FUNCTIONS]](https://lightning.ai/docs/pytorch/stable/notebooks/course_UvA-DL/02-activation-functions.html), Author: Phillip Lippe, License: [[CC BY-SA]](https://creativecommons.org/licenses/by-sa/3.0/), Generated: 2023-03-15T09:52:39.179933.\n\n:::\n\nAfter we have trained the models, we can look at the actual activation values that find inside the model. For instance, how many neurons are set to zero in ReLU? Where do we find most values in Tanh? To answer these questions, we can write a simple function which takes a trained model, applies it to a batch of images, and plots the histogram of the activations inside the network:\n\n::: {.cell execution_count=24}\n``` {.python .cell-code}\nfrom spotPython.torch.activation import Sigmoid, Tanh, ReLU, LeakyReLU, ELU, Swish\nact_fn_by_name = {\"sigmoid\": Sigmoid, \"tanh\": Tanh, \"relu\": ReLU, \"leakyrelu\": LeakyReLU, \"elu\": ELU, \"swish\": Swish}\n```\n:::\n\n\n::: {.cell execution_count=25}\n``` {.python .cell-code}\nfrom spotPython.hyperparameters.values import get_one_config_from_X\nX = spot_tuner.to_all_dim(spot_tuner.min_X.reshape(1,-1))\nconfig = get_one_config_from_X(X, fun_control)\nmodel = fun_control[\"core_model\"](**config, _L_in=64, _L_out=11)\nmodel\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```\nNetLightRegression(\n  (layers): Sequential(\n    (0): Linear(in_features=64, out_features=256, bias=True)\n    (1): LeakyReLU()\n    (2): Dropout(p=0.05448797256538013, inplace=False)\n    (3): Linear(in_features=256, out_features=128, bias=True)\n    (4): LeakyReLU()\n    (5): Dropout(p=0.05448797256538013, inplace=False)\n    (6): Linear(in_features=128, out_features=128, bias=True)\n    (7): LeakyReLU()\n    (8): Dropout(p=0.05448797256538013, inplace=False)\n    (9): Linear(in_features=128, out_features=64, bias=True)\n    (10): LeakyReLU()\n    (11): Dropout(p=0.05448797256538013, inplace=False)\n    (12): Linear(in_features=64, out_features=11, bias=True)\n  )\n)\n```\n:::\n:::\n\n\n::: {.cell execution_count=26}\n``` {.python .cell-code}\n# from spotPython.utils.eda import visualize_activations\n# visualize_activations(model, color=f\"C{0}\")\n```\n:::\n\n\n",
    "supporting": [
      "033_spot_lightning_linear_sensitive_files/figure-pdf"
    ],
    "filters": []
  }
}